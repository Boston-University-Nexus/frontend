{"version":3,"file":"headlessui.cjs.development.js","sources":["../src/hooks/use-iso-morphic-effect.ts","../src/hooks/use-id.ts","../src/hooks/use-is-initial-render.ts","../src/utils/match.ts","../src/hooks/use-is-mounted.ts","../src/utils/render.ts","../src/utils/once.ts","../src/utils/disposables.ts","../src/components/transitions/utils/transition.ts","../src/components/transitions/transition.tsx","../src/hooks/use-disposables.ts","../src/hooks/use-sync-refs.ts","../src/components/keyboard.ts","../src/utils/calculate-active-index.ts","../src/utils/resolve-prop-value.ts","../src/utils/bugs.ts","../src/components/menu/menu.tsx","../src/hooks/use-computed.ts","../src/components/listbox/listbox.tsx","../src/components/switch/switch.tsx"],"sourcesContent":["import { useLayoutEffect, useEffect } from 'react'\n\nexport const useIsoMorphicEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect\n","import { useState, useEffect } from 'react'\nimport { useIsoMorphicEffect } from './use-iso-morphic-effect'\n\n// We used a \"simple\" approach first which worked for SSR and rehydration on the client. However we\n// didn't take care of the Suspense case. To fix this we used the approach the @reach-ui/auto-id\n// uses.\n//\n// Credits: https://github.com/reach/reach-ui/blob/develop/packages/auto-id/src/index.tsx\n\nlet state = { serverHandoffComplete: false }\nlet id = 0\nfunction generateId() {\n  return ++id\n}\n\nexport function useId() {\n  let [id, setId] = useState(state.serverHandoffComplete ? generateId : null)\n\n  useIsoMorphicEffect(() => {\n    if (id === null) setId(generateId())\n  }, [id])\n\n  useEffect(() => {\n    if (state.serverHandoffComplete === false) state.serverHandoffComplete = true\n  }, [])\n\n  return id != null ? '' + id : undefined\n}\n","import { useRef, useEffect } from 'react'\n\nexport function useIsInitialRender() {\n  let initial = useRef(true)\n\n  useEffect(() => {\n    initial.current = false\n  }, [])\n\n  return initial.current\n}\n","export function match<TValue extends string | number = string, TReturnValue = unknown>(\n  value: TValue,\n  lookup: Record<TValue, TReturnValue | ((...args: any[]) => TReturnValue)>,\n  ...args: any[]\n): TReturnValue {\n  if (value in lookup) {\n    let returnValue = lookup[value]\n    return typeof returnValue === 'function' ? returnValue(...args) : returnValue\n  }\n\n  let error = new Error(\n    `Tried to handle \"${value}\" but there is no handler defined. Only defined handlers are: ${Object.keys(\n      lookup\n    )\n      .map(key => `\"${key}\"`)\n      .join(', ')}.`\n  )\n  if (Error.captureStackTrace) Error.captureStackTrace(error, match)\n  throw error\n}\n","import { useRef, useEffect } from 'react'\n\nexport function useIsMounted() {\n  let mounted = useRef(true)\n\n  useEffect(() => {\n    return () => {\n      mounted.current = false\n    }\n  }, [])\n\n  return mounted\n}\n","import {\n  Fragment,\n  cloneElement,\n  createElement,\n  forwardRef,\n  isValidElement,\n\n  // Types\n  ElementType,\n  ReactElement,\n} from 'react'\nimport { Props, XOR, __, Expand } from '../types'\nimport { match } from './match'\n\nexport enum Features {\n  /** No features at all */\n  None = 0,\n\n  /**\n   * When used, this will allow us to use one of the render strategies.\n   *\n   * **The render strategies are:**\n   *    - **Unmount**   _(Will unmount the component.)_\n   *    - **Hidden**    _(Will hide the component using the [hidden] attribute.)_\n   */\n  RenderStrategy = 1,\n\n  /**\n   * When used, this will allow the user of our component to be in control. This can be used when\n   * you want to transition based on some state.\n   */\n  Static = 2,\n}\n\nexport enum RenderStrategy {\n  Unmount,\n  Hidden,\n}\n\ntype PropsForFeature<TPassedInFeatures extends Features, TForFeature extends Features, TProps> = {\n  [P in TPassedInFeatures]: P extends TForFeature ? TProps : __\n}[TPassedInFeatures]\n\nexport type PropsForFeatures<T extends Features> = XOR<\n  PropsForFeature<T, Features.Static, { static?: boolean }>,\n  PropsForFeature<T, Features.RenderStrategy, { unmount?: boolean }>\n>\n\nexport function render<TFeature extends Features, TTag extends ElementType, TBag>(\n  props: Expand<Props<TTag, TBag, any> & PropsForFeatures<TFeature>>,\n  propsBag: TBag,\n  defaultTag: ElementType,\n  features?: TFeature,\n  visible: boolean = true\n) {\n  // Visible always render\n  if (visible) return _render(props, propsBag, defaultTag)\n\n  let featureFlags = features ?? Features.None\n\n  if (featureFlags & Features.Static) {\n    let { static: isStatic = false, ...rest } = props as PropsForFeatures<Features.Static>\n\n    // When the `static` prop is passed as `true`, then the user is in control, thus we don't care about anything else\n    if (isStatic) return _render(rest, propsBag, defaultTag)\n  }\n\n  if (featureFlags & Features.RenderStrategy) {\n    let { unmount = true, ...rest } = props as PropsForFeatures<Features.RenderStrategy>\n    let strategy = unmount ? RenderStrategy.Unmount : RenderStrategy.Hidden\n\n    return match(strategy, {\n      [RenderStrategy.Unmount]() {\n        return null\n      },\n      [RenderStrategy.Hidden]() {\n        return _render(\n          { ...rest, ...{ hidden: true, style: { display: 'none' } } },\n          propsBag,\n          defaultTag\n        )\n      },\n    })\n  }\n\n  // No features enabled, just render\n  return _render(props, propsBag, defaultTag)\n}\n\nfunction _render<TTag extends ElementType, TBag>(\n  props: Props<TTag, TBag> & { ref?: unknown },\n  bag: TBag,\n  tag: ElementType\n) {\n  let { as: Component = tag, children, refName = 'ref', ...passThroughProps } = omit(props, [\n    'unmount',\n    'static',\n  ])\n\n  // This allows us to use `<HeadlessUIComponent as={MyComopnent} refName=\"innerRef\" />`\n  let refRelatedProps = props.ref !== undefined ? { [refName]: props.ref } : {}\n\n  let resolvedChildren = (typeof children === 'function' ? children(bag) : children) as\n    | ReactElement\n    | ReactElement[]\n\n  if (Component === Fragment) {\n    if (Object.keys(passThroughProps).length > 0) {\n      if (Array.isArray(resolvedChildren) && resolvedChildren.length > 1) {\n        let err = new Error('You should only render 1 child')\n        if (Error.captureStackTrace) Error.captureStackTrace(err, _render)\n        throw err\n      }\n\n      if (!isValidElement(resolvedChildren)) {\n        let err = new Error(\n          `You should render an element as a child. Did you forget the as=\"...\" prop?`\n        )\n        if (Error.captureStackTrace) Error.captureStackTrace(err, _render)\n        throw err\n      }\n\n      return cloneElement(\n        resolvedChildren,\n        Object.assign(\n          {},\n          // Filter out undefined values so that they don't override the existing values\n          mergeEventFunctions(compact(omit(passThroughProps, ['ref'])), resolvedChildren.props, [\n            'onClick',\n          ]),\n          refRelatedProps\n        )\n      )\n    }\n  }\n\n  return createElement(\n    Component,\n    Object.assign({}, omit(passThroughProps, ['ref']), Component !== Fragment && refRelatedProps),\n    resolvedChildren\n  )\n}\n\n/**\n * We can use this function for the following useCase:\n *\n * <Menu.Item> <button onClick={console.log} /> </Menu.Item>\n *\n * Our `Menu.Item` will have an internal `onClick`, if you passthrough an `onClick` to the actual\n * `Menu.Item` component we will call it correctly. However, when we have an `onClick` on the actual\n * first child, that one should _also_ be called (but before this implementation, it was just\n * overriding the `onClick`). But it is only when we *render* that we have access to the existing\n * props of this component.\n *\n * It's a bit hacky, and not that clean, but it is something internal and we have tests to rely on\n * so that we can refactor this later (if needed).\n */\nfunction mergeEventFunctions(\n  passThroughProps: Record<string, any>,\n  existingProps: Record<string, any>,\n  functionsToMerge: string[]\n) {\n  let clone = Object.assign({}, passThroughProps)\n  for (let func of functionsToMerge) {\n    if (passThroughProps[func] !== undefined && existingProps[func] !== undefined) {\n      Object.assign(clone, {\n        [func](event: { defaultPrevented: boolean }) {\n          // Props we control\n          if (!event.defaultPrevented) passThroughProps[func](event)\n\n          // Existing props on the component\n          if (!event.defaultPrevented) existingProps[func](event)\n        },\n      })\n    }\n  }\n\n  return clone\n}\n\n/**\n * This is a hack, but basically we want to keep the full 'API' of the component, but we do want to\n * wrap it in a forwardRef so that we _can_ passthrough the ref\n */\nexport function forwardRefWithAs<T>(component: T): T {\n  return forwardRef((component as unknown) as any) as any\n}\n\nfunction compact<T extends Record<any, any>>(object: T) {\n  let clone = Object.assign({}, object)\n  for (let key in clone) {\n    if (clone[key] === undefined) delete clone[key]\n  }\n  return clone\n}\n\nfunction omit<T extends Record<any, any>>(object: T, keysToOmit: string[] = []) {\n  let clone = Object.assign({}, object)\n  for (let key of keysToOmit) {\n    if (key in clone) delete clone[key]\n  }\n  return clone\n}\n","export function once<T>(cb: (...args: T[]) => void) {\n  let state = { called: false }\n\n  return (...args: T[]) => {\n    if (state.called) return\n    state.called = true\n    return cb(...args)\n  }\n}\n","export function disposables() {\n  let disposables: Function[] = []\n\n  let api = {\n    requestAnimationFrame(...args: Parameters<typeof requestAnimationFrame>) {\n      let raf = requestAnimationFrame(...args)\n      api.add(() => cancelAnimationFrame(raf))\n    },\n\n    nextFrame(...args: Parameters<typeof requestAnimationFrame>) {\n      api.requestAnimationFrame(() => {\n        api.requestAnimationFrame(...args)\n      })\n    },\n\n    setTimeout(...args: Parameters<typeof setTimeout>) {\n      let timer = setTimeout(...args)\n      api.add(() => clearTimeout(timer))\n    },\n\n    add(cb: () => void) {\n      disposables.push(cb)\n    },\n\n    dispose() {\n      for (let dispose of disposables.splice(0)) {\n        dispose()\n      }\n    },\n  }\n\n  return api\n}\n","import { once } from '../../../utils/once'\nimport { disposables } from '../../../utils/disposables'\n\nfunction addClasses(node: HTMLElement, ...classes: string[]) {\n  node && classes.length > 0 && node.classList.add(...classes)\n}\n\nfunction removeClasses(node: HTMLElement, ...classes: string[]) {\n  node && classes.length > 0 && node.classList.remove(...classes)\n}\n\nexport enum Reason {\n  Finished = 'finished',\n  Cancelled = 'cancelled',\n}\n\nfunction waitForTransition(node: HTMLElement, done: (reason: Reason) => void) {\n  let d = disposables()\n\n  if (!node) return d.dispose\n\n  // Safari returns a comma separated list of values, so let's sort them and take the highest value.\n  let { transitionDuration, transitionDelay } = getComputedStyle(node)\n\n  let [durationMs, delaysMs] = [transitionDuration, transitionDelay].map(value => {\n    let [resolvedValue = 0] = value\n      .split(',')\n      // Remove falseys we can't work with\n      .filter(Boolean)\n      // Values are returned as `0.3s` or `75ms`\n      .map(v => (v.includes('ms') ? parseFloat(v) : parseFloat(v) * 1000))\n      .sort((a, z) => z - a)\n\n    return resolvedValue\n  })\n\n  // Waiting for the transition to end. We could use the `transitionend` event, however when no\n  // actual transition/duration is defined then the `transitionend` event is not fired.\n  //\n  // TODO: Downside is, when you slow down transitions via devtools this timeout is still using the\n  // full 100% speed instead of the 25% or 10%.\n  if (durationMs !== 0) {\n    d.setTimeout(() => {\n      done(Reason.Finished)\n    }, durationMs + delaysMs)\n  } else {\n    // No transition is happening, so we should cleanup already. Otherwise we have to wait until we\n    // get disposed.\n    done(Reason.Finished)\n  }\n\n  // If we get disposed before the timeout runs we should cleanup anyway\n  d.add(() => done(Reason.Cancelled))\n\n  return d.dispose\n}\n\nexport function transition(\n  node: HTMLElement,\n  base: string[],\n  from: string[],\n  to: string[],\n  done?: (reason: Reason) => void\n) {\n  let d = disposables()\n  let _done = done !== undefined ? once(done) : () => {}\n\n  addClasses(node, ...base, ...from)\n\n  d.nextFrame(() => {\n    removeClasses(node, ...from)\n    addClasses(node, ...to)\n\n    d.add(\n      waitForTransition(node, reason => {\n        removeClasses(node, ...to, ...base)\n        return _done(reason)\n      })\n    )\n  })\n\n  // Once we get disposed, we should ensure that we cleanup after ourselves. In case of an unmount,\n  // the node itself will be nullified and will be a no-op. In case of a full transition the classes\n  // are already removed which is also a no-op. However if you go from enter -> leave mid-transition\n  // then we have some leftovers that should be cleaned.\n  d.add(() => removeClasses(node, ...base, ...from, ...to))\n\n  // When we get disposed early, than we should also call the done method but switch the reason.\n  d.add(() => _done(Reason.Cancelled))\n\n  return d.dispose\n}\n","import React, {\n  useMemo,\n  createContext,\n  useContext,\n  useRef,\n  useEffect,\n  useCallback,\n  useState,\n  Fragment,\n\n  // Types\n  ElementType,\n  MutableRefObject,\n} from 'react'\nimport { Props } from '../../types'\n\nimport { useId } from '../../hooks/use-id'\nimport { useIsInitialRender } from '../../hooks/use-is-initial-render'\nimport { match } from '../../utils/match'\nimport { useIsMounted } from '../../hooks/use-is-mounted'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\n\nimport { Features, PropsForFeatures, render, RenderStrategy } from '../../utils/render'\nimport { Reason, transition } from './utils/transition'\n\ntype ID = ReturnType<typeof useId>\n\nfunction useSplitClasses(classes: string = '') {\n  return useMemo(() => classes.split(' ').filter(className => className.trim().length > 1), [\n    classes,\n  ])\n}\n\ninterface TransitionContextValues {\n  show: boolean\n  appear: boolean\n}\nlet TransitionContext = createContext<TransitionContextValues | null>(null)\nTransitionContext.displayName = 'TransitionContext'\n\nenum TreeStates {\n  Visible = 'visible',\n  Hidden = 'hidden',\n}\n\nexport interface TransitionClasses {\n  enter?: string\n  enterFrom?: string\n  enterTo?: string\n  leave?: string\n  leaveFrom?: string\n  leaveTo?: string\n}\n\nexport interface TransitionEvents {\n  beforeEnter?: () => void\n  afterEnter?: () => void\n  beforeLeave?: () => void\n  afterLeave?: () => void\n}\n\ntype TransitionChildProps<TTag> = Props<TTag, TransitionChildRenderPropArg> &\n  PropsForFeatures<typeof TransitionChildRenderFeatures> &\n  TransitionClasses &\n  TransitionEvents & { appear?: boolean }\n\nfunction useTransitionContext() {\n  let context = useContext(TransitionContext)\n\n  if (context === null) {\n    throw new Error('A <Transition.Child /> is used but it is missing a parent <Transition />.')\n  }\n\n  return context\n}\n\nfunction useParentNesting() {\n  let context = useContext(NestingContext)\n\n  if (context === null) {\n    throw new Error('A <Transition.Child /> is used but it is missing a parent <Transition />.')\n  }\n\n  return context\n}\n\ninterface NestingContextValues {\n  children: MutableRefObject<{ id: ID; state: TreeStates }[]>\n  register: (id: ID) => () => void\n  unregister: (id: ID, strategy?: RenderStrategy) => void\n}\n\nlet NestingContext = createContext<NestingContextValues | null>(null)\nNestingContext.displayName = 'NestingContext'\n\nfunction hasChildren(\n  bag: NestingContextValues['children'] | { children: NestingContextValues['children'] }\n): boolean {\n  if ('children' in bag) return hasChildren(bag.children)\n  return bag.current.filter(({ state }) => state === TreeStates.Visible).length > 0\n}\n\nfunction useNesting(done?: () => void) {\n  let doneRef = useRef(done)\n  let transitionableChildren = useRef<NestingContextValues['children']['current']>([])\n  let mounted = useIsMounted()\n\n  useEffect(() => {\n    doneRef.current = done\n  }, [done])\n\n  let unregister = useCallback(\n    (childId: ID, strategy = RenderStrategy.Hidden) => {\n      let idx = transitionableChildren.current.findIndex(({ id }) => id === childId)\n      if (idx === -1) return\n\n      match(strategy, {\n        [RenderStrategy.Unmount]() {\n          transitionableChildren.current.splice(idx, 1)\n        },\n        [RenderStrategy.Hidden]() {\n          transitionableChildren.current[idx].state = TreeStates.Hidden\n        },\n      })\n\n      if (!hasChildren(transitionableChildren) && mounted.current) {\n        doneRef.current?.()\n      }\n    },\n    [doneRef, mounted, transitionableChildren]\n  )\n\n  let register = useCallback(\n    (childId: ID) => {\n      let child = transitionableChildren.current.find(({ id }) => id === childId)\n      if (!child) {\n        transitionableChildren.current.push({ id: childId, state: TreeStates.Visible })\n      } else if (child.state !== TreeStates.Visible) {\n        child.state = TreeStates.Visible\n      }\n\n      return () => unregister(childId, RenderStrategy.Unmount)\n    },\n    [transitionableChildren, unregister]\n  )\n\n  return useMemo(\n    () => ({\n      children: transitionableChildren,\n      register,\n      unregister,\n    }),\n    [register, unregister, transitionableChildren]\n  )\n}\n\nfunction noop() {}\nlet eventNames: (keyof TransitionEvents)[] = [\n  'beforeEnter',\n  'afterEnter',\n  'beforeLeave',\n  'afterLeave',\n]\nfunction ensureEventHooksExist(events: TransitionEvents) {\n  return eventNames.reduce((all, eventName) => {\n    all[eventName] = events[eventName] || noop\n    return all\n  }, {} as Record<keyof TransitionEvents, () => void>)\n}\n\nfunction useEvents(events: TransitionEvents) {\n  let eventsRef = useRef(ensureEventHooksExist(events))\n\n  useEffect(() => {\n    eventsRef.current = ensureEventHooksExist(events)\n  }, [events])\n\n  return eventsRef\n}\n\n// ---\n\nlet DEFAULT_TRANSITION_CHILD_TAG = 'div' as const\ntype TransitionChildRenderPropArg = MutableRefObject<HTMLDivElement>\nlet TransitionChildRenderFeatures = Features.RenderStrategy\n\nfunction TransitionChild<TTag extends ElementType = typeof DEFAULT_TRANSITION_CHILD_TAG>(\n  props: TransitionChildProps<TTag>\n) {\n  let {\n    // Event \"handlers\"\n    beforeEnter,\n    afterEnter,\n    beforeLeave,\n    afterLeave,\n\n    // Class names\n    enter,\n    enterFrom,\n    enterTo,\n    leave,\n    leaveFrom,\n    leaveTo,\n\n    // @ts-expect-error\n    ...rest\n  } = props as typeof props\n  let container = useRef<HTMLElement | null>(null)\n  let [state, setState] = useState(TreeStates.Visible)\n  let strategy = rest.unmount ? RenderStrategy.Unmount : RenderStrategy.Hidden\n\n  let { show, appear } = useTransitionContext()\n  let { register, unregister } = useParentNesting()\n\n  let initial = useIsInitialRender()\n  let id = useId()\n\n  let isTransitioning = useRef(false)\n\n  let nesting = useNesting(() => {\n    // When all children have been unmounted we can only hide ourselves if and only if we are not\n    // transitioning ourserlves. Otherwise we would unmount before the transitions are finished.\n    if (!isTransitioning.current) {\n      setState(TreeStates.Hidden)\n      unregister(id)\n      events.current.afterLeave()\n    }\n  })\n\n  useIsoMorphicEffect(() => {\n    if (!id) return\n    return register(id)\n  }, [register, id])\n\n  useIsoMorphicEffect(() => {\n    // If we are in another mode than the Hidden mode then ignore\n    if (strategy !== RenderStrategy.Hidden) return\n    if (!id) return\n\n    // Make sure that we are visible\n    if (show && state !== TreeStates.Visible) {\n      setState(TreeStates.Visible)\n      return\n    }\n\n    match(state, {\n      [TreeStates.Hidden]: () => unregister(id),\n      [TreeStates.Visible]: () => register(id),\n    })\n  }, [state, id, register, unregister, show, strategy])\n\n  let enterClasses = useSplitClasses(enter)\n  let enterFromClasses = useSplitClasses(enterFrom)\n  let enterToClasses = useSplitClasses(enterTo)\n\n  let leaveClasses = useSplitClasses(leave)\n  let leaveFromClasses = useSplitClasses(leaveFrom)\n  let leaveToClasses = useSplitClasses(leaveTo)\n\n  let events = useEvents({ beforeEnter, afterEnter, beforeLeave, afterLeave })\n\n  useEffect(() => {\n    if (state === TreeStates.Visible && container.current === null) {\n      throw new Error('Did you forget to passthrough the `ref` to the actual DOM node?')\n    }\n  }, [container, state])\n\n  // Skipping initial transition\n  let skip = initial && !appear\n\n  useIsoMorphicEffect(() => {\n    let node = container.current\n    if (!node) return\n    if (skip) return\n\n    isTransitioning.current = true\n\n    if (show) events.current.beforeEnter()\n    if (!show) events.current.beforeLeave()\n\n    return show\n      ? transition(node, enterClasses, enterFromClasses, enterToClasses, reason => {\n          isTransitioning.current = false\n          if (reason === Reason.Finished) events.current.afterEnter()\n        })\n      : transition(node, leaveClasses, leaveFromClasses, leaveToClasses, reason => {\n          isTransitioning.current = false\n\n          if (reason !== Reason.Finished) return\n\n          // When we don't have children anymore we can safely unregister from the parent and hide\n          // ourselves.\n          if (!hasChildren(nesting)) {\n            setState(TreeStates.Hidden)\n            unregister(id)\n            events.current.afterLeave()\n          }\n        })\n  }, [\n    events,\n    id,\n    isTransitioning,\n    unregister,\n    nesting,\n    container,\n    skip,\n    show,\n    enterClasses,\n    enterFromClasses,\n    enterToClasses,\n    leaveClasses,\n    leaveFromClasses,\n    leaveToClasses,\n  ])\n\n  let propsBag = {}\n  let propsWeControl = { ref: container }\n  let passthroughProps = rest\n\n  return (\n    <NestingContext.Provider value={nesting}>\n      {render(\n        { ...passthroughProps, ...propsWeControl },\n        propsBag,\n        DEFAULT_TRANSITION_CHILD_TAG,\n        TransitionChildRenderFeatures,\n        state === TreeStates.Visible\n      )}\n    </NestingContext.Provider>\n  )\n}\n\nexport function Transition<TTag extends ElementType = typeof DEFAULT_TRANSITION_CHILD_TAG>(\n  props: TransitionChildProps<TTag> & { show: boolean; appear?: boolean }\n) {\n  // @ts-expect-error\n  let { show, appear = false, unmount, ...passthroughProps } = props as typeof props\n\n  if (![true, false].includes(show)) {\n    throw new Error('A <Transition /> is used but it is missing a `show={true | false}` prop.')\n  }\n\n  let [state, setState] = useState(show ? TreeStates.Visible : TreeStates.Hidden)\n\n  let nestingBag = useNesting(() => {\n    setState(TreeStates.Hidden)\n  })\n\n  let initial = useIsInitialRender()\n  let transitionBag = useMemo<TransitionContextValues>(\n    () => ({ show, appear: appear || !initial }),\n    [show, appear, initial]\n  )\n\n  useEffect(() => {\n    if (show) {\n      setState(TreeStates.Visible)\n    } else if (!hasChildren(nestingBag)) {\n      setState(TreeStates.Hidden)\n    }\n  }, [show, nestingBag])\n\n  let sharedProps = { unmount }\n  let propsBag = {}\n\n  return (\n    <NestingContext.Provider value={nestingBag}>\n      <TransitionContext.Provider value={transitionBag}>\n        {render(\n          {\n            ...sharedProps,\n            as: Fragment,\n            children: <TransitionChild {...sharedProps} {...passthroughProps} />,\n          },\n          propsBag,\n          Fragment,\n          TransitionChildRenderFeatures,\n          state === TreeStates.Visible\n        )}\n      </TransitionContext.Provider>\n    </NestingContext.Provider>\n  )\n}\n\nTransition.Child = TransitionChild\n","import { useState, useEffect } from 'react'\n\nimport { disposables } from '../utils/disposables'\n\nexport function useDisposables() {\n  // Using useState instead of useRef so that we can use the initializer function.\n  let [d] = useState(disposables)\n  useEffect(() => () => d.dispose(), [d])\n  return d\n}\n","import { useCallback } from 'react'\n\nexport function useSyncRefs<TType>(\n  ...refs: (React.MutableRefObject<TType> | ((instance: TType) => void) | null)[]\n) {\n  return useCallback(\n    (value: TType) => {\n      refs.forEach(ref => {\n        if (ref === null) return\n        if (typeof ref === 'function') return ref(value)\n        ref.current = value\n      })\n    },\n    [refs]\n  )\n}\n","// TODO: This must already exist somewhere, right? 🤔\n// Ref: https://www.w3.org/TR/uievents-key/#named-key-attribute-values\nexport enum Keys {\n  Space = ' ',\n  Enter = 'Enter',\n  Escape = 'Escape',\n  Backspace = 'Backspace',\n\n  ArrowUp = 'ArrowUp',\n  ArrowDown = 'ArrowDown',\n\n  Home = 'Home',\n  End = 'End',\n\n  PageUp = 'PageUp',\n  PageDown = 'PageDown',\n\n  Tab = 'Tab',\n}\n","function assertNever(x: never): never {\n  throw new Error('Unexpected object: ' + x)\n}\n\nexport enum Focus {\n  /** Focus the first non-disabled item. */\n  First,\n\n  /** Focus the previous non-disabled item. */\n  Previous,\n\n  /** Focus the next non-disabled item. */\n  Next,\n\n  /** Focus the last non-disabled item. */\n  Last,\n\n  /** Focus a specific item based on the `id` of the item. */\n  Specific,\n\n  /** Focus no items at all. */\n  Nothing,\n}\n\nexport function calculateActiveIndex<TItem>(\n  action: { focus: Focus.Specific; id: string } | { focus: Exclude<Focus, Focus.Specific> },\n  resolvers: {\n    resolveItems(): TItem[]\n    resolveActiveIndex(): number | null\n    resolveId(item: TItem): string\n    resolveDisabled(item: TItem): boolean\n  }\n) {\n  let items = resolvers.resolveItems()\n  if (items.length <= 0) return null\n\n  let currentActiveIndex = resolvers.resolveActiveIndex()\n  let activeIndex = currentActiveIndex ?? -1\n\n  let nextActiveIndex = (() => {\n    switch (action.focus) {\n      case Focus.First:\n        return items.findIndex(item => !resolvers.resolveDisabled(item))\n\n      case Focus.Previous: {\n        let idx = items\n          .slice()\n          .reverse()\n          .findIndex((item, idx, all) => {\n            if (activeIndex !== -1 && all.length - idx - 1 >= activeIndex) return false\n            return !resolvers.resolveDisabled(item)\n          })\n        if (idx === -1) return idx\n        return items.length - 1 - idx\n      }\n\n      case Focus.Next:\n        return items.findIndex((item, idx) => {\n          if (idx <= activeIndex) return false\n          return !resolvers.resolveDisabled(item)\n        })\n\n      case Focus.Last: {\n        let idx = items\n          .slice()\n          .reverse()\n          .findIndex(item => !resolvers.resolveDisabled(item))\n        if (idx === -1) return idx\n        return items.length - 1 - idx\n      }\n\n      case Focus.Specific:\n        return items.findIndex(item => resolvers.resolveId(item) === action.id)\n\n      case Focus.Nothing:\n        return null\n\n      default:\n        assertNever(action)\n    }\n  })()\n\n  return nextActiveIndex === -1 ? currentActiveIndex : nextActiveIndex\n}\n","export function resolvePropValue<TProperty, TBag>(property: TProperty, bag: TBag) {\n  if (property === undefined) return undefined\n  if (typeof property === 'function') return property(bag)\n  return property\n}\n","// See: https://github.com/facebook/react/issues/7711\n// See: https://github.com/facebook/react/pull/20612\n// See: https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#concept-fe-disabled (2.)\nexport function isDisabledReactIssue7711(element: Element): boolean {\n  let parent = element.parentElement\n  let legend = null\n\n  while (parent && !(parent instanceof HTMLFieldSetElement)) {\n    if (parent instanceof HTMLLegendElement) legend = parent\n    parent = parent.parentElement\n  }\n\n  let isParentDisabled = parent?.getAttribute('disabled') === '' ?? false\n  if (isParentDisabled && isFirstLegend(legend)) return false\n\n  return isParentDisabled\n}\n\nfunction isFirstLegend(element: HTMLLegendElement | null): boolean {\n  if (!element) return false\n\n  let previous = element.previousElementSibling\n\n  while (previous !== null) {\n    if (previous instanceof HTMLLegendElement) return false\n    previous = previous.previousElementSibling\n  }\n\n  return true\n}\n","// WAI-ARIA: https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton\nimport React, {\n  createContext,\n  createRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  Fragment,\n\n  // Types\n  Dispatch,\n  ElementType,\n  KeyboardEvent as ReactKeyboardEvent,\n  MouseEvent as ReactMouseEvent,\n  MutableRefObject,\n  Ref,\n} from 'react'\n\nimport { Props } from '../../types'\nimport { match } from '../../utils/match'\nimport { forwardRefWithAs, render, Features, PropsForFeatures } from '../../utils/render'\nimport { disposables } from '../../utils/disposables'\nimport { useDisposables } from '../../hooks/use-disposables'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { useId } from '../../hooks/use-id'\nimport { Keys } from '../keyboard'\nimport { Focus, calculateActiveIndex } from '../../utils/calculate-active-index'\nimport { resolvePropValue } from '../../utils/resolve-prop-value'\nimport { isDisabledReactIssue7711 } from '../../utils/bugs'\n\nenum MenuStates {\n  Open,\n  Closed,\n}\n\ntype MenuItemDataRef = MutableRefObject<{ textValue?: string; disabled: boolean }>\n\ninterface StateDefinition {\n  menuState: MenuStates\n  buttonRef: MutableRefObject<HTMLButtonElement | null>\n  itemsRef: MutableRefObject<HTMLDivElement | null>\n  items: { id: string; dataRef: MenuItemDataRef }[]\n  searchQuery: string\n  activeItemIndex: number | null\n}\n\nenum ActionTypes {\n  OpenMenu,\n  CloseMenu,\n\n  GoToItem,\n  Search,\n  ClearSearch,\n\n  RegisterItem,\n  UnregisterItem,\n}\n\ntype Actions =\n  | { type: ActionTypes.CloseMenu }\n  | { type: ActionTypes.OpenMenu }\n  | { type: ActionTypes.GoToItem; focus: Focus.Specific; id: string }\n  | { type: ActionTypes.GoToItem; focus: Exclude<Focus, Focus.Specific> }\n  | { type: ActionTypes.Search; value: string }\n  | { type: ActionTypes.ClearSearch }\n  | { type: ActionTypes.RegisterItem; id: string; dataRef: MenuItemDataRef }\n  | { type: ActionTypes.UnregisterItem; id: string }\n\nlet reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.CloseMenu]: state => ({\n    ...state,\n    activeItemIndex: null,\n    menuState: MenuStates.Closed,\n  }),\n  [ActionTypes.OpenMenu]: state => ({ ...state, menuState: MenuStates.Open }),\n  [ActionTypes.GoToItem]: (state, action) => {\n    let activeItemIndex = calculateActiveIndex(action, {\n      resolveItems: () => state.items,\n      resolveActiveIndex: () => state.activeItemIndex,\n      resolveId: item => item.id,\n      resolveDisabled: item => item.dataRef.current.disabled,\n    })\n\n    if (state.searchQuery === '' && state.activeItemIndex === activeItemIndex) return state\n    return { ...state, searchQuery: '', activeItemIndex }\n  },\n  [ActionTypes.Search]: (state, action) => {\n    let searchQuery = state.searchQuery + action.value\n    let match = state.items.findIndex(\n      item =>\n        item.dataRef.current.textValue?.startsWith(searchQuery) && !item.dataRef.current.disabled\n    )\n\n    if (match === -1 || match === state.activeItemIndex) return { ...state, searchQuery }\n    return { ...state, searchQuery, activeItemIndex: match }\n  },\n  [ActionTypes.ClearSearch]: state => ({ ...state, searchQuery: '' }),\n  [ActionTypes.RegisterItem]: (state, action) => ({\n    ...state,\n    items: [...state.items, { id: action.id, dataRef: action.dataRef }],\n  }),\n  [ActionTypes.UnregisterItem]: (state, action) => {\n    let nextItems = state.items.slice()\n    let currentActiveItem = state.activeItemIndex !== null ? nextItems[state.activeItemIndex] : null\n\n    let idx = nextItems.findIndex(a => a.id === action.id)\n\n    if (idx !== -1) nextItems.splice(idx, 1)\n\n    return {\n      ...state,\n      items: nextItems,\n      activeItemIndex: (() => {\n        if (idx === state.activeItemIndex) return null\n        if (currentActiveItem === null) return null\n\n        // If we removed the item before the actual active index, then it would be out of sync. To\n        // fix this, we will find the correct (new) index position.\n        return nextItems.indexOf(currentActiveItem)\n      })(),\n    }\n  },\n}\n\nlet MenuContext = createContext<[StateDefinition, Dispatch<Actions>] | null>(null)\nMenuContext.displayName = 'MenuContext'\n\nfunction useMenuContext(component: string) {\n  let context = useContext(MenuContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <${Menu.name} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useMenuContext)\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nlet DEFAULT_MENU_TAG = Fragment\ninterface MenuRenderPropArg {\n  open: boolean\n}\n\nexport function Menu<TTag extends ElementType = typeof DEFAULT_MENU_TAG>(\n  props: Props<TTag, MenuRenderPropArg>\n) {\n  let reducerBag = useReducer(stateReducer, {\n    menuState: MenuStates.Closed,\n    buttonRef: createRef(),\n    itemsRef: createRef(),\n    items: [],\n    searchQuery: '',\n    activeItemIndex: null,\n  } as StateDefinition)\n  let [{ menuState, itemsRef, buttonRef }, dispatch] = reducerBag\n\n  useEffect(() => {\n    function handler(event: MouseEvent) {\n      let target = event.target as HTMLElement\n      let active = document.activeElement\n\n      if (menuState !== MenuStates.Open) return\n      if (buttonRef.current?.contains(target)) return\n\n      if (!itemsRef.current?.contains(target)) dispatch({ type: ActionTypes.CloseMenu })\n      if (active !== document.body && active?.contains(target)) return // Keep focus on newly clicked/focused element\n      if (!event.defaultPrevented) buttonRef.current?.focus({ preventScroll: true })\n    }\n\n    window.addEventListener('mousedown', handler)\n    return () => window.removeEventListener('mousedown', handler)\n  }, [menuState, itemsRef, buttonRef, dispatch])\n\n  let propsBag = useMemo(() => ({ open: menuState === MenuStates.Open }), [menuState])\n\n  return (\n    <MenuContext.Provider value={reducerBag}>\n      {render(props, propsBag, DEFAULT_MENU_TAG)}\n    </MenuContext.Provider>\n  )\n}\n\n// ---\n\nlet DEFAULT_BUTTON_TAG = 'button' as const\ninterface ButtonRenderPropArg {\n  open: boolean\n}\ntype ButtonPropsWeControl =\n  | 'id'\n  | 'type'\n  | 'aria-haspopup'\n  | 'aria-controls'\n  | 'aria-expanded'\n  | 'onKeyDown'\n  | 'onClick'\n\nlet Button = forwardRefWithAs(function Button<TTag extends ElementType = typeof DEFAULT_BUTTON_TAG>(\n  props: Props<TTag, ButtonRenderPropArg, ButtonPropsWeControl>,\n  ref: Ref<HTMLButtonElement>\n) {\n  let [state, dispatch] = useMenuContext([Menu.name, Button.name].join('.'))\n  let buttonRef = useSyncRefs(state.buttonRef, ref)\n\n  let id = `headlessui-menu-button-${useId()}`\n  let d = useDisposables()\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLButtonElement>) => {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => {\n            state.itemsRef.current?.focus({ preventScroll: true })\n            dispatch({ type: ActionTypes.GoToItem, focus: Focus.First })\n          })\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => {\n            state.itemsRef.current?.focus({ preventScroll: true })\n            dispatch({ type: ActionTypes.GoToItem, focus: Focus.Last })\n          })\n          break\n      }\n    },\n    [dispatch, state, d]\n  )\n\n  let handleClick = useCallback(\n    (event: ReactMouseEvent) => {\n      if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault()\n      if (props.disabled) return\n      if (state.menuState === MenuStates.Open) {\n        dispatch({ type: ActionTypes.CloseMenu })\n        d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      } else {\n        event.preventDefault()\n        dispatch({ type: ActionTypes.OpenMenu })\n        d.nextFrame(() => state.itemsRef.current?.focus({ preventScroll: true }))\n      }\n    },\n    [dispatch, d, state, props.disabled]\n  )\n\n  let propsBag = useMemo(() => ({ open: state.menuState === MenuStates.Open }), [state])\n  let passthroughProps = props\n  let propsWeControl = {\n    ref: buttonRef,\n    id,\n    type: 'button',\n    'aria-haspopup': true,\n    'aria-controls': state.itemsRef.current?.id,\n    'aria-expanded': state.menuState === MenuStates.Open ? true : undefined,\n    onKeyDown: handleKeyDown,\n    onClick: handleClick,\n  }\n\n  return render({ ...passthroughProps, ...propsWeControl }, propsBag, DEFAULT_BUTTON_TAG)\n})\n\n// ---\n\nlet DEFAULT_ITEMS_TAG = 'div' as const\ninterface ItemsRenderPropArg {\n  open: boolean\n}\ntype ItemsPropsWeControl =\n  | 'aria-activedescendant'\n  | 'aria-labelledby'\n  | 'id'\n  | 'onKeyDown'\n  | 'role'\n  | 'tabIndex'\n\nlet ItemsRenderFeatures = Features.RenderStrategy | Features.Static\n\nlet Items = forwardRefWithAs(function Items<TTag extends ElementType = typeof DEFAULT_ITEMS_TAG>(\n  props: Props<TTag, ItemsRenderPropArg, ItemsPropsWeControl> &\n    PropsForFeatures<typeof ItemsRenderFeatures>,\n  ref: Ref<HTMLDivElement>\n) {\n  let [state, dispatch] = useMenuContext([Menu.name, Items.name].join('.'))\n  let itemsRef = useSyncRefs(state.itemsRef, ref)\n\n  let id = `headlessui-menu-items-${useId()}`\n  let searchDisposables = useDisposables()\n\n  useIsoMorphicEffect(() => {\n    let container = state.itemsRef.current\n    if (!container) return\n    if (state.menuState !== MenuStates.Open) return\n\n    let walker = document.createTreeWalker(container, NodeFilter.SHOW_ELEMENT, {\n      acceptNode(node: HTMLElement) {\n        if (node.getAttribute('role') === 'menuitem') return NodeFilter.FILTER_REJECT\n        if (node.hasAttribute('role')) return NodeFilter.FILTER_SKIP\n        return NodeFilter.FILTER_ACCEPT\n      },\n    })\n\n    while (walker.nextNode()) {\n      ;(walker.currentNode as HTMLElement).setAttribute('role', 'none')\n    }\n  })\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLDivElement>) => {\n      searchDisposables.dispose()\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (state.searchQuery !== '') {\n            event.preventDefault()\n            return dispatch({ type: ActionTypes.Search, value: event.key })\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.CloseMenu })\n          if (state.activeItemIndex !== null) {\n            let { id } = state.items[state.activeItemIndex]\n            document.getElementById(id)?.click()\n          }\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.ArrowDown:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Next })\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Previous })\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.First })\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Last })\n\n        case Keys.Escape:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.CloseMenu })\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.Tab:\n          return event.preventDefault()\n\n        default:\n          if (event.key.length === 1) {\n            dispatch({ type: ActionTypes.Search, value: event.key })\n            searchDisposables.setTimeout(() => dispatch({ type: ActionTypes.ClearSearch }), 350)\n          }\n          break\n      }\n    },\n    [dispatch, searchDisposables, state]\n  )\n\n  let propsBag = useMemo(() => ({ open: state.menuState === MenuStates.Open }), [state])\n  let propsWeControl = {\n    'aria-activedescendant':\n      state.activeItemIndex === null ? undefined : state.items[state.activeItemIndex]?.id,\n    'aria-labelledby': state.buttonRef.current?.id,\n    id,\n    onKeyDown: handleKeyDown,\n    role: 'menu',\n    tabIndex: 0,\n    ref: itemsRef,\n  }\n  let passthroughProps = props\n\n  return render(\n    { ...passthroughProps, ...propsWeControl },\n    propsBag,\n    DEFAULT_ITEMS_TAG,\n    ItemsRenderFeatures,\n    state.menuState === MenuStates.Open\n  )\n})\n\n// ---\n\nlet DEFAULT_ITEM_TAG = Fragment\ninterface ItemRenderPropArg {\n  active: boolean\n  disabled: boolean\n}\ntype MenuItemPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-disabled'\n  | 'onPointerLeave'\n  | 'onPointerMove'\n  | 'onMouseLeave'\n  | 'onMouseMove'\n  | 'onFocus'\n\nfunction Item<TTag extends ElementType = typeof DEFAULT_ITEM_TAG>(\n  props: Props<TTag, ItemRenderPropArg, MenuItemPropsWeControl | 'className'> & {\n    disabled?: boolean\n    onClick?: (event: { preventDefault: Function }) => void\n\n    // Special treatment, can either be a string or a function that resolves to a string\n    className?: ((bag: ItemRenderPropArg) => string) | string\n  }\n) {\n  let { disabled = false, className, onClick, ...passthroughProps } = props\n  let [state, dispatch] = useMenuContext([Menu.name, Item.name].join('.'))\n  let id = `headlessui-menu-item-${useId()}`\n  let active = state.activeItemIndex !== null ? state.items[state.activeItemIndex].id === id : false\n\n  useIsoMorphicEffect(() => {\n    if (state.menuState !== MenuStates.Open) return\n    if (!active) return\n    let d = disposables()\n    d.nextFrame(() => document.getElementById(id)?.scrollIntoView?.({ block: 'nearest' }))\n    return d.dispose\n  }, [id, active, state.menuState])\n\n  let bag = useRef<MenuItemDataRef['current']>({ disabled })\n\n  useIsoMorphicEffect(() => {\n    bag.current.disabled = disabled\n  }, [bag, disabled])\n\n  useIsoMorphicEffect(() => {\n    bag.current.textValue = document.getElementById(id)?.textContent?.toLowerCase()\n  }, [bag, id])\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterItem, id, dataRef: bag })\n    return () => dispatch({ type: ActionTypes.UnregisterItem, id })\n  }, [bag, id])\n\n  let handleClick = useCallback(\n    (event: MouseEvent) => {\n      if (disabled) return event.preventDefault()\n      dispatch({ type: ActionTypes.CloseMenu })\n      disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      if (onClick) return onClick(event)\n    },\n    [dispatch, state.buttonRef, disabled, onClick]\n  )\n\n  let handleFocus = useCallback(() => {\n    if (disabled) return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Specific, id })\n  }, [disabled, id, dispatch])\n\n  let handleMove = useCallback(() => {\n    if (disabled) return\n    if (active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Specific, id })\n  }, [disabled, active, id, dispatch])\n\n  let handleLeave = useCallback(() => {\n    if (disabled) return\n    if (!active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n  }, [disabled, active, dispatch])\n\n  let propsBag = useMemo(() => ({ active, disabled }), [active, disabled])\n  let propsWeControl = {\n    id,\n    role: 'menuitem',\n    tabIndex: -1,\n    className: resolvePropValue(className, propsBag),\n    'aria-disabled': disabled === true ? true : undefined,\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave,\n  }\n\n  return render({ ...passthroughProps, ...propsWeControl }, propsBag, DEFAULT_ITEM_TAG)\n}\n\n// ---\n\nMenu.Button = Button\nMenu.Items = Items\nMenu.Item = Item\n","import { useState, useRef } from 'react'\nimport { useIsoMorphicEffect } from './use-iso-morphic-effect'\n\nexport function useComputed<T>(cb: () => T, dependencies: React.DependencyList) {\n  let [value, setValue] = useState(cb)\n  let cbRef = useRef(cb)\n  useIsoMorphicEffect(() => {\n    cbRef.current = cb\n  }, [cb])\n  useIsoMorphicEffect(() => setValue(cbRef.current), [cbRef, setValue, ...dependencies])\n  return value\n}\n","import React, {\n  createContext,\n  createRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  Fragment,\n\n  // Types\n  Dispatch,\n  ElementType,\n  KeyboardEvent as ReactKeyboardEvent,\n  MouseEvent as ReactMouseEvent,\n  MutableRefObject,\n  Ref,\n} from 'react'\n\nimport { useDisposables } from '../../hooks/use-disposables'\nimport { useId } from '../../hooks/use-id'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useComputed } from '../../hooks/use-computed'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { Props } from '../../types'\nimport { Features, forwardRefWithAs, PropsForFeatures, render } from '../../utils/render'\nimport { match } from '../../utils/match'\nimport { disposables } from '../../utils/disposables'\nimport { Keys } from '../keyboard'\nimport { Focus, calculateActiveIndex } from '../../utils/calculate-active-index'\nimport { resolvePropValue } from '../../utils/resolve-prop-value'\nimport { isDisabledReactIssue7711 } from '../../utils/bugs'\n\nenum ListboxStates {\n  Open,\n  Closed,\n}\n\ntype ListboxOptionDataRef = MutableRefObject<{\n  textValue?: string\n  disabled: boolean\n  value: unknown\n}>\n\ninterface StateDefinition {\n  listboxState: ListboxStates\n  propsRef: MutableRefObject<{ value: unknown; onChange(value: unknown): void }>\n  labelRef: MutableRefObject<HTMLLabelElement | null>\n  buttonRef: MutableRefObject<HTMLButtonElement | null>\n  optionsRef: MutableRefObject<HTMLUListElement | null>\n  disabled: boolean\n  options: { id: string; dataRef: ListboxOptionDataRef }[]\n  searchQuery: string\n  activeOptionIndex: number | null\n}\n\nenum ActionTypes {\n  OpenListbox,\n  CloseListbox,\n\n  SetDisabled,\n\n  GoToOption,\n  Search,\n  ClearSearch,\n\n  RegisterOption,\n  UnregisterOption,\n}\n\ntype Actions =\n  | { type: ActionTypes.CloseListbox }\n  | { type: ActionTypes.OpenListbox }\n  | { type: ActionTypes.SetDisabled; disabled: boolean }\n  | { type: ActionTypes.GoToOption; focus: Focus.Specific; id: string }\n  | { type: ActionTypes.GoToOption; focus: Exclude<Focus, Focus.Specific> }\n  | { type: ActionTypes.Search; value: string }\n  | { type: ActionTypes.ClearSearch }\n  | { type: ActionTypes.RegisterOption; id: string; dataRef: ListboxOptionDataRef }\n  | { type: ActionTypes.UnregisterOption; id: string }\n\nlet reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.CloseListbox](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n    return { ...state, activeOptionIndex: null, listboxState: ListboxStates.Closed }\n  },\n  [ActionTypes.OpenListbox](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Open) return state\n    return { ...state, listboxState: ListboxStates.Open }\n  },\n  [ActionTypes.SetDisabled](state, action) {\n    if (state.disabled === action.disabled) return state\n    return { ...state, disabled: action.disabled }\n  },\n  [ActionTypes.GoToOption](state, action) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n\n    let activeOptionIndex = calculateActiveIndex(action, {\n      resolveItems: () => state.options,\n      resolveActiveIndex: () => state.activeOptionIndex,\n      resolveId: item => item.id,\n      resolveDisabled: item => item.dataRef.current.disabled,\n    })\n\n    if (state.searchQuery === '' && state.activeOptionIndex === activeOptionIndex) return state\n    return { ...state, searchQuery: '', activeOptionIndex }\n  },\n  [ActionTypes.Search]: (state, action) => {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n\n    let searchQuery = state.searchQuery + action.value\n    let match = state.options.findIndex(\n      option =>\n        !option.dataRef.current.disabled &&\n        option.dataRef.current.textValue?.startsWith(searchQuery)\n    )\n\n    if (match === -1 || match === state.activeOptionIndex) return { ...state, searchQuery }\n    return { ...state, searchQuery, activeOptionIndex: match }\n  },\n  [ActionTypes.ClearSearch](state) {\n    if (state.disabled) return state\n    if (state.listboxState === ListboxStates.Closed) return state\n    if (state.searchQuery === '') return state\n    return { ...state, searchQuery: '' }\n  },\n  [ActionTypes.RegisterOption]: (state, action) => ({\n    ...state,\n    options: [...state.options, { id: action.id, dataRef: action.dataRef }],\n  }),\n  [ActionTypes.UnregisterOption]: (state, action) => {\n    let nextOptions = state.options.slice()\n    let currentActiveOption =\n      state.activeOptionIndex !== null ? nextOptions[state.activeOptionIndex] : null\n\n    let idx = nextOptions.findIndex(a => a.id === action.id)\n\n    if (idx !== -1) nextOptions.splice(idx, 1)\n\n    return {\n      ...state,\n      options: nextOptions,\n      activeOptionIndex: (() => {\n        if (idx === state.activeOptionIndex) return null\n        if (currentActiveOption === null) return null\n\n        // If we removed the option before the actual active index, then it would be out of sync. To\n        // fix this, we will find the correct (new) index position.\n        return nextOptions.indexOf(currentActiveOption)\n      })(),\n    }\n  },\n}\n\nlet ListboxContext = createContext<[StateDefinition, Dispatch<Actions>] | null>(null)\nListboxContext.displayName = 'ListboxContext'\n\nfunction useListboxContext(component: string) {\n  let context = useContext(ListboxContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <${Listbox.name} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useListboxContext)\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nlet DEFAULT_LISTBOX_TAG = Fragment\ninterface ListboxRenderPropArg {\n  open: boolean\n  disabled: boolean\n}\n\nexport function Listbox<TTag extends ElementType = typeof DEFAULT_LISTBOX_TAG, TType = string>(\n  props: Props<TTag, ListboxRenderPropArg, 'value' | 'onChange'> & {\n    value: TType\n    onChange(value: TType): void\n    disabled?: boolean\n  }\n) {\n  let { value, onChange, disabled = false, ...passThroughProps } = props\n  let d = useDisposables()\n  let reducerBag = useReducer(stateReducer, {\n    listboxState: ListboxStates.Closed,\n    propsRef: { current: { value, onChange } },\n    labelRef: createRef(),\n    buttonRef: createRef(),\n    optionsRef: createRef(),\n    disabled,\n    options: [],\n    searchQuery: '',\n    activeOptionIndex: null,\n  } as StateDefinition)\n  let [{ listboxState, propsRef, optionsRef, buttonRef }, dispatch] = reducerBag\n\n  useIsoMorphicEffect(() => {\n    propsRef.current.value = value\n  }, [value, propsRef])\n  useIsoMorphicEffect(() => {\n    propsRef.current.onChange = onChange\n  }, [onChange, propsRef])\n  useIsoMorphicEffect(() => dispatch({ type: ActionTypes.SetDisabled, disabled }), [disabled])\n\n  useEffect(() => {\n    function handler(event: MouseEvent) {\n      let target = event.target as HTMLElement\n      let active = document.activeElement\n\n      if (listboxState !== ListboxStates.Open) return\n      if (buttonRef.current?.contains(target)) return\n\n      if (!optionsRef.current?.contains(target)) dispatch({ type: ActionTypes.CloseListbox })\n      if (active !== document.body && active?.contains(target)) return // Keep focus on newly clicked/focused element\n      if (!event.defaultPrevented) buttonRef.current?.focus({ preventScroll: true })\n    }\n\n    window.addEventListener('mousedown', handler)\n    return () => window.removeEventListener('mousedown', handler)\n  }, [listboxState, optionsRef, buttonRef, d, dispatch])\n\n  let propsBag = useMemo<ListboxRenderPropArg>(\n    () => ({ open: listboxState === ListboxStates.Open, disabled }),\n    [listboxState, disabled]\n  )\n\n  return (\n    <ListboxContext.Provider value={reducerBag}>\n      {render(passThroughProps, propsBag, DEFAULT_LISTBOX_TAG)}\n    </ListboxContext.Provider>\n  )\n}\n\n// ---\n\nlet DEFAULT_BUTTON_TAG = 'button' as const\ninterface ButtonRenderPropArg {\n  open: boolean\n  disabled: boolean\n}\ntype ButtonPropsWeControl =\n  | 'id'\n  | 'type'\n  | 'aria-haspopup'\n  | 'aria-controls'\n  | 'aria-expanded'\n  | 'aria-labelledby'\n  | 'disabled'\n  | 'onKeyDown'\n  | 'onClick'\n\nlet Button = forwardRefWithAs(function Button<TTag extends ElementType = typeof DEFAULT_BUTTON_TAG>(\n  props: Props<TTag, ButtonRenderPropArg, ButtonPropsWeControl>,\n  ref: Ref<HTMLButtonElement>\n) {\n  let [state, dispatch] = useListboxContext([Listbox.name, Button.name].join('.'))\n  let buttonRef = useSyncRefs(state.buttonRef, ref)\n\n  let id = `headlessui-listbox-button-${useId()}`\n  let d = useDisposables()\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLButtonElement>) => {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenListbox })\n          d.nextFrame(() => {\n            state.optionsRef.current?.focus({ preventScroll: true })\n            if (!state.propsRef.current.value)\n              dispatch({ type: ActionTypes.GoToOption, focus: Focus.First })\n          })\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.OpenListbox })\n          d.nextFrame(() => {\n            state.optionsRef.current?.focus({ preventScroll: true })\n            if (!state.propsRef.current.value)\n              dispatch({ type: ActionTypes.GoToOption, focus: Focus.Last })\n          })\n          break\n      }\n    },\n    [dispatch, state, d]\n  )\n\n  let handleClick = useCallback(\n    (event: ReactMouseEvent) => {\n      if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault()\n      if (state.listboxState === ListboxStates.Open) {\n        dispatch({ type: ActionTypes.CloseListbox })\n        d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      } else {\n        event.preventDefault()\n        dispatch({ type: ActionTypes.OpenListbox })\n        d.nextFrame(() => state.optionsRef.current?.focus({ preventScroll: true }))\n      }\n    },\n    [dispatch, d, state]\n  )\n\n  let labelledby = useComputed(() => {\n    if (!state.labelRef.current) return undefined\n    return [state.labelRef.current.id, id].join(' ')\n  }, [state.labelRef.current, id])\n\n  let propsBag = useMemo<ButtonRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open, disabled: state.disabled }),\n    [state]\n  )\n  let passthroughProps = props\n  let propsWeControl = {\n    ref: buttonRef,\n    id,\n    type: 'button',\n    'aria-haspopup': true,\n    'aria-controls': state.optionsRef.current?.id,\n    'aria-expanded': state.listboxState === ListboxStates.Open ? true : undefined,\n    'aria-labelledby': labelledby,\n    disabled: state.disabled,\n    onKeyDown: handleKeyDown,\n    onClick: handleClick,\n  }\n\n  return render({ ...passthroughProps, ...propsWeControl }, propsBag, DEFAULT_BUTTON_TAG)\n})\n\n// ---\n\nlet DEFAULT_LABEL_TAG = 'label' as const\ninterface LabelRenderPropArg {\n  open: boolean\n  disabled: boolean\n}\ntype LabelPropsWeControl = 'id' | 'ref' | 'onClick'\n\nfunction Label<TTag extends ElementType = typeof DEFAULT_LABEL_TAG>(\n  props: Props<TTag, LabelRenderPropArg, LabelPropsWeControl>\n) {\n  let [state] = useListboxContext([Listbox.name, Label.name].join('.'))\n  let id = `headlessui-listbox-label-${useId()}`\n\n  let handleClick = useCallback(() => state.buttonRef.current?.focus({ preventScroll: true }), [\n    state.buttonRef,\n  ])\n\n  let propsBag = useMemo<LabelRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open, disabled: state.disabled }),\n    [state]\n  )\n  let propsWeControl = { ref: state.labelRef, id, onClick: handleClick }\n  return render({ ...props, ...propsWeControl }, propsBag, DEFAULT_LABEL_TAG)\n}\n\n// ---\n\nlet DEFAULT_OPTIONS_TAG = 'ul' as const\ninterface OptionsRenderPropArg {\n  open: boolean\n}\ntype OptionsPropsWeControl =\n  | 'aria-activedescendant'\n  | 'aria-labelledby'\n  | 'id'\n  | 'onKeyDown'\n  | 'role'\n  | 'tabIndex'\n\nlet OptionsRenderFeatures = Features.RenderStrategy | Features.Static\n\nlet Options = forwardRefWithAs(function Options<\n  TTag extends ElementType = typeof DEFAULT_OPTIONS_TAG\n>(\n  props: Props<TTag, OptionsRenderPropArg, OptionsPropsWeControl> &\n    PropsForFeatures<typeof OptionsRenderFeatures>,\n  ref: Ref<HTMLUListElement>\n) {\n  let [state, dispatch] = useListboxContext([Listbox.name, Options.name].join('.'))\n  let optionsRef = useSyncRefs(state.optionsRef, ref)\n\n  let id = `headlessui-listbox-options-${useId()}`\n  let d = useDisposables()\n  let searchDisposables = useDisposables()\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLUListElement>) => {\n      searchDisposables.dispose()\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (state.searchQuery !== '') {\n            event.preventDefault()\n            return dispatch({ type: ActionTypes.Search, value: event.key })\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.CloseListbox })\n          if (state.activeOptionIndex !== null) {\n            let { dataRef } = state.options[state.activeOptionIndex]\n            state.propsRef.current.onChange(dataRef.current.value)\n          }\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.ArrowDown:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Next })\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Previous })\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.First })\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Last })\n\n        case Keys.Escape:\n          event.preventDefault()\n          dispatch({ type: ActionTypes.CloseListbox })\n          return d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n\n        case Keys.Tab:\n          return event.preventDefault()\n\n        default:\n          if (event.key.length === 1) {\n            dispatch({ type: ActionTypes.Search, value: event.key })\n            searchDisposables.setTimeout(() => dispatch({ type: ActionTypes.ClearSearch }), 350)\n          }\n          break\n      }\n    },\n    [d, dispatch, searchDisposables, state]\n  )\n\n  let labelledby = useComputed(() => state.labelRef.current?.id ?? state.buttonRef.current?.id, [\n    state.labelRef.current,\n    state.buttonRef.current,\n  ])\n\n  let propsBag = useMemo<OptionsRenderPropArg>(\n    () => ({ open: state.listboxState === ListboxStates.Open }),\n    [state]\n  )\n  let propsWeControl = {\n    'aria-activedescendant':\n      state.activeOptionIndex === null ? undefined : state.options[state.activeOptionIndex]?.id,\n    'aria-labelledby': labelledby,\n    id,\n    onKeyDown: handleKeyDown,\n    role: 'listbox',\n    tabIndex: 0,\n    ref: optionsRef,\n  }\n  let passthroughProps = props\n\n  return render(\n    { ...passthroughProps, ...propsWeControl },\n    propsBag,\n    DEFAULT_OPTIONS_TAG,\n    OptionsRenderFeatures,\n    state.listboxState === ListboxStates.Open\n  )\n})\n\n// ---\n\nlet DEFAULT_OPTION_TAG = 'li' as const\ninterface OptionRenderPropArg {\n  active: boolean\n  selected: boolean\n  disabled: boolean\n}\ntype ListboxOptionPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-disabled'\n  | 'aria-selected'\n  | 'onPointerLeave'\n  | 'onMouseLeave'\n  | 'onPointerMove'\n  | 'onMouseMove'\n  | 'onFocus'\n\nfunction Option<\n  TTag extends ElementType = typeof DEFAULT_OPTION_TAG,\n  // TODO: One day we will be able to infer this type from the generic in Listbox itself.\n  // But today is not that day..\n  TType = Parameters<typeof Listbox>[0]['value']\n>(\n  props: Props<TTag, OptionRenderPropArg, ListboxOptionPropsWeControl | 'className' | 'value'> & {\n    disabled?: boolean\n    value: TType\n\n    // Special treatment, can either be a string or a function that resolves to a string\n    className?: ((bag: OptionRenderPropArg) => string) | string\n  }\n) {\n  let { disabled = false, value, className, ...passthroughProps } = props\n  let [state, dispatch] = useListboxContext([Listbox.name, Option.name].join('.'))\n  let id = `headlessui-listbox-option-${useId()}`\n  let active =\n    state.activeOptionIndex !== null ? state.options[state.activeOptionIndex].id === id : false\n  let selected = state.propsRef.current.value === value\n\n  let bag = useRef<ListboxOptionDataRef['current']>({ disabled, value })\n\n  useIsoMorphicEffect(() => {\n    bag.current.disabled = disabled\n  }, [bag, disabled])\n  useIsoMorphicEffect(() => {\n    bag.current.value = value\n  }, [bag, value])\n  useIsoMorphicEffect(() => {\n    bag.current.textValue = document.getElementById(id)?.textContent?.toLowerCase()\n  }, [bag, id])\n\n  let select = useCallback(() => state.propsRef.current.onChange(value), [state.propsRef, value])\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterOption, id, dataRef: bag })\n    return () => dispatch({ type: ActionTypes.UnregisterOption, id })\n  }, [bag, id])\n\n  useIsoMorphicEffect(() => {\n    if (state.listboxState !== ListboxStates.Open) return\n    if (!selected) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n    document.getElementById(id)?.focus?.()\n  }, [state.listboxState])\n\n  useIsoMorphicEffect(() => {\n    if (state.listboxState !== ListboxStates.Open) return\n    if (!active) return\n    let d = disposables()\n    d.nextFrame(() => document.getElementById(id)?.scrollIntoView?.({ block: 'nearest' }))\n    return d.dispose\n  }, [id, active, state.listboxState])\n\n  let handleClick = useCallback(\n    (event: { preventDefault: Function }) => {\n      if (disabled) return event.preventDefault()\n      select()\n      dispatch({ type: ActionTypes.CloseListbox })\n      disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n    },\n    [dispatch, state.buttonRef, disabled, select]\n  )\n\n  let handleFocus = useCallback(() => {\n    if (disabled) return dispatch({ type: ActionTypes.GoToOption, focus: Focus.Nothing })\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n  }, [disabled, id, dispatch])\n\n  let handleMove = useCallback(() => {\n    if (disabled) return\n    if (active) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Specific, id })\n  }, [disabled, active, id, dispatch])\n\n  let handleLeave = useCallback(() => {\n    if (disabled) return\n    if (!active) return\n    dispatch({ type: ActionTypes.GoToOption, focus: Focus.Nothing })\n  }, [disabled, active, dispatch])\n\n  let propsBag = useMemo(() => ({ active, selected, disabled }), [active, selected, disabled])\n  let propsWeControl = {\n    id,\n    role: 'option',\n    tabIndex: -1,\n    className: resolvePropValue(className, propsBag),\n    'aria-disabled': disabled === true ? true : undefined,\n    'aria-selected': selected === true ? true : undefined,\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave,\n  }\n\n  return render({ ...passthroughProps, ...propsWeControl }, propsBag, DEFAULT_OPTION_TAG)\n}\n\n// ---\n\nListbox.Button = Button\nListbox.Label = Label\nListbox.Options = Options\nListbox.Option = Option\n","import React, {\n  createContext,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n  Fragment,\n\n  // Types\n  ElementType,\n  KeyboardEvent as ReactKeyboardEvent,\n  MouseEvent as ReactMouseEvent,\n} from 'react'\n\nimport { Props } from '../../types'\nimport { render } from '../../utils/render'\nimport { useId } from '../../hooks/use-id'\nimport { Keys } from '../keyboard'\nimport { resolvePropValue } from '../../utils/resolve-prop-value'\nimport { isDisabledReactIssue7711 } from '../../utils/bugs'\n\ninterface StateDefinition {\n  switch: HTMLButtonElement | null\n  label: HTMLLabelElement | null\n\n  setSwitch(element: HTMLButtonElement): void\n  setLabel(element: HTMLLabelElement): void\n}\n\nlet GroupContext = createContext<StateDefinition | null>(null)\nGroupContext.displayName = 'GroupContext'\n\nfunction useGroupContext(component: string) {\n  let context = useContext(GroupContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <Switch.Group /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useGroupContext)\n    throw err\n  }\n  return context\n}\n\n// ---\n\nlet DEFAULT_GROUP_TAG = Fragment\n\nfunction Group<TTag extends ElementType = typeof DEFAULT_GROUP_TAG>(props: Props<TTag>) {\n  let [switchElement, setSwitchElement] = useState<HTMLButtonElement | null>(null)\n  let [labelElement, setLabelElement] = useState<HTMLLabelElement | null>(null)\n\n  let context = useMemo<StateDefinition>(\n    () => ({\n      switch: switchElement,\n      label: labelElement,\n      setSwitch: setSwitchElement,\n      setLabel: setLabelElement,\n    }),\n    [switchElement, setSwitchElement, labelElement, setLabelElement]\n  )\n\n  return (\n    <GroupContext.Provider value={context}>\n      {render(props, {}, DEFAULT_GROUP_TAG)}\n    </GroupContext.Provider>\n  )\n}\n\n// ---\n\nlet DEFAULT_SWITCH_TAG = 'button' as const\ninterface SwitchRenderPropArg {\n  checked: boolean\n}\ntype SwitchPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-checked'\n  | 'onClick'\n  | 'onKeyUp'\n  | 'onKeyPress'\n\nexport function Switch<TTag extends ElementType = typeof DEFAULT_SWITCH_TAG>(\n  props: Props<\n    TTag,\n    SwitchRenderPropArg,\n    SwitchPropsWeControl | 'checked' | 'onChange' | 'className'\n  > & {\n    checked: boolean\n    onChange(checked: boolean): void\n\n    // Special treatment, can either be a string or a function that resolves to a string\n    className?: ((bag: SwitchRenderPropArg) => string) | string\n  }\n) {\n  let { checked, onChange, className, ...passThroughProps } = props\n  let id = `headlessui-switch-${useId()}`\n  let groupContext = useContext(GroupContext)\n\n  let toggle = useCallback(() => onChange(!checked), [onChange, checked])\n  let handleClick = useCallback(\n    (event: ReactMouseEvent) => {\n      if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault()\n      event.preventDefault()\n      toggle()\n    },\n    [toggle]\n  )\n  let handleKeyUp = useCallback(\n    (event: ReactKeyboardEvent<HTMLElement>) => {\n      if (event.key !== Keys.Tab) event.preventDefault()\n      if (event.key === Keys.Space) toggle()\n    },\n    [toggle]\n  )\n\n  // This is needed so that we can \"cancel\" the click event when we use the `Enter` key on a button.\n  let handleKeyPress = useCallback(\n    (event: ReactKeyboardEvent<HTMLElement>) => event.preventDefault(),\n    []\n  )\n\n  let propsBag = useMemo<SwitchRenderPropArg>(() => ({ checked }), [checked])\n  let propsWeControl = {\n    id,\n    ref: groupContext === null ? undefined : groupContext.setSwitch,\n    role: 'switch',\n    tabIndex: 0,\n    className: resolvePropValue(className, propsBag),\n    'aria-checked': checked,\n    'aria-labelledby': groupContext?.label?.id,\n    onClick: handleClick,\n    onKeyUp: handleKeyUp,\n    onKeyPress: handleKeyPress,\n  }\n\n  if (passThroughProps.as === 'button') {\n    Object.assign(propsWeControl, { type: 'button' })\n  }\n\n  return render({ ...passThroughProps, ...propsWeControl }, propsBag, DEFAULT_SWITCH_TAG)\n}\n\n// ---\n\nlet DEFAULT_LABEL_TAG = 'label' as const\ninterface LabelRenderPropArg {}\ntype LabelPropsWeControl = 'id' | 'ref' | 'onClick'\n\nfunction Label<TTag extends ElementType = typeof DEFAULT_LABEL_TAG>(\n  props: Props<TTag, LabelRenderPropArg, LabelPropsWeControl>\n) {\n  let state = useGroupContext([Switch.name, Label.name].join('.'))\n  let id = `headlessui-switch-label-${useId()}`\n\n  let handleClick = useCallback(() => {\n    if (!state.switch) return\n    state.switch.click()\n    state.switch.focus({ preventScroll: true })\n  }, [state.switch])\n\n  let propsWeControl = { ref: state.setLabel, id, onClick: handleClick }\n  return render({ ...props, ...propsWeControl }, {}, DEFAULT_LABEL_TAG)\n}\n\n// ---\n\nSwitch.Group = Group\nSwitch.Label = Label\n"],"names":["useIsoMorphicEffect","window","useLayoutEffect","useEffect","state","serverHandoffComplete","id","generateId","useId","useState","setId","undefined","useIsInitialRender","initial","useRef","current","match","value","lookup","returnValue","args","error","Error","Object","keys","map","key","join","captureStackTrace","useIsMounted","mounted","Features","RenderStrategy","render","props","propsBag","defaultTag","features","visible","_render","featureFlags","None","Static","isStatic","rest","unmount","strategy","Unmount","Hidden","hidden","style","display","bag","tag","omit","as","Component","children","refName","passThroughProps","refRelatedProps","ref","resolvedChildren","Fragment","length","Array","isArray","err","isValidElement","cloneElement","assign","mergeEventFunctions","compact","createElement","existingProps","functionsToMerge","clone","func","event","defaultPrevented","forwardRefWithAs","component","forwardRef","object","keysToOmit","once","cb","called","disposables","api","requestAnimationFrame","raf","add","cancelAnimationFrame","nextFrame","setTimeout","timer","clearTimeout","push","dispose","splice","addClasses","node","classes","classList","removeClasses","remove","Reason","waitForTransition","done","d","getComputedStyle","transitionDuration","transitionDelay","split","filter","Boolean","v","includes","parseFloat","sort","a","z","resolvedValue","durationMs","delaysMs","Finished","Cancelled","transition","base","from","to","_done","reason","useSplitClasses","useMemo","className","trim","TransitionContext","createContext","displayName","TreeStates","useTransitionContext","context","useContext","useParentNesting","NestingContext","hasChildren","Visible","useNesting","doneRef","transitionableChildren","unregister","useCallback","childId","idx","findIndex","register","child","find","noop","eventNames","ensureEventHooksExist","events","reduce","all","eventName","useEvents","eventsRef","DEFAULT_TRANSITION_CHILD_TAG","TransitionChildRenderFeatures","TransitionChild","beforeEnter","afterEnter","beforeLeave","afterLeave","enter","enterFrom","enterTo","leave","leaveFrom","leaveTo","container","setState","show","appear","isTransitioning","nesting","enterClasses","enterFromClasses","enterToClasses","leaveClasses","leaveFromClasses","leaveToClasses","skip","propsWeControl","passthroughProps","React","Provider","Transition","nestingBag","transitionBag","sharedProps","Child","useDisposables","useSyncRefs","refs","forEach","Keys","assertNever","x","Focus","calculateActiveIndex","action","resolvers","items","resolveItems","currentActiveIndex","resolveActiveIndex","activeIndex","nextActiveIndex","focus","First","item","resolveDisabled","Previous","slice","reverse","Next","Last","Specific","resolveId","Nothing","resolvePropValue","property","isDisabledReactIssue7711","element","parent","parentElement","legend","HTMLFieldSetElement","HTMLLegendElement","isParentDisabled","getAttribute","isFirstLegend","previous","previousElementSibling","MenuStates","ActionTypes","reducers","CloseMenu","activeItemIndex","menuState","Closed","OpenMenu","Open","GoToItem","dataRef","disabled","searchQuery","Search","textValue","startsWith","ClearSearch","RegisterItem","UnregisterItem","nextItems","currentActiveItem","indexOf","MenuContext","useMenuContext","Menu","name","stateReducer","type","DEFAULT_MENU_TAG","reducerBag","useReducer","buttonRef","createRef","itemsRef","dispatch","handler","target","active","document","activeElement","contains","body","preventScroll","addEventListener","removeEventListener","open","DEFAULT_BUTTON_TAG","Button","handleKeyDown","Space","Enter","ArrowDown","preventDefault","ArrowUp","handleClick","currentTarget","onKeyDown","onClick","DEFAULT_ITEMS_TAG","ItemsRenderFeatures","Items","searchDisposables","walker","createTreeWalker","NodeFilter","SHOW_ELEMENT","acceptNode","FILTER_REJECT","hasAttribute","FILTER_SKIP","FILTER_ACCEPT","nextNode","currentNode","setAttribute","getElementById","click","Home","PageUp","End","PageDown","Escape","Tab","role","tabIndex","DEFAULT_ITEM_TAG","Item","scrollIntoView","block","textContent","toLowerCase","handleFocus","handleMove","handleLeave","onFocus","onPointerMove","onMouseMove","onPointerLeave","onMouseLeave","useComputed","dependencies","setValue","cbRef","ListboxStates","CloseListbox","listboxState","activeOptionIndex","OpenListbox","SetDisabled","GoToOption","options","option","RegisterOption","UnregisterOption","nextOptions","currentActiveOption","ListboxContext","useListboxContext","Listbox","DEFAULT_LISTBOX_TAG","onChange","propsRef","labelRef","optionsRef","labelledby","DEFAULT_LABEL_TAG","Label","DEFAULT_OPTIONS_TAG","OptionsRenderFeatures","Options","DEFAULT_OPTION_TAG","Option","selected","select","GroupContext","useGroupContext","DEFAULT_GROUP_TAG","Group","switchElement","setSwitchElement","labelElement","setLabelElement","label","setSwitch","setLabel","DEFAULT_SWITCH_TAG","Switch","checked","groupContext","toggle","handleKeyUp","handleKeyPress","onKeyUp","onKeyPress"],"mappings":"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"}